<article class="wrapper style2">
    <div class="container">
        <header style="text-align: left;">
            <h2>Publications</h2>
        </header>
        <div class="row aln-center">
            <div id="publications-list"></div>
        </div>
    </div>
</article>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<script>
function getTypeInfo(type) {
    switch(type.toLowerCase()) {
        case 'article': 
            return {
                icon: 'fa-newspaper',
                label: 'Journal',
                color: '#3498db'
            };
        case 'inproceedings': 
            return {
                icon: 'fa-users',
                label: 'Conference',
                color: '#27ae60'
            };
        case 'book': 
            return {
                icon: 'fa-book',
                label: 'Book',
                color: '#8e44ad'
            };
        case 'incollection': 
            return {
                icon: 'fa-book-open',
                label: 'Book Chapter',
                color: '#e67e22'
            };
        case 'misc': 
            return {
                icon: 'fa-file-alt',
                label: 'Pre-print',
                color: '#c0392b'
            };
        default: 
            return {
                icon: 'fa-file',
                label: 'Other',
                color: '#7f8c8d'
            };
    }
}

function loadPublications() {
    const container = document.getElementById('publications-list');
    if (!container) {
        console.error('Could not find publications-list element');
        return;
    }

    fetch('../bibliography/6477.bib')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.text();
        })
        .then(bibtex => {
            try {
                const entries = bibtexParse.toJSON(bibtex);
                if (!entries || entries.length === 0) {
                    throw new Error('No entries found in bibliography');
                }

                // Group entries by year
                const entriesByYear = entries.reduce((acc, entry) => {
                    const year = entry.entryTags.year || 'Unknown';
                    if (!acc[year]) acc[year] = [];
                    acc[year].push(entry);
                    return acc;
                }, {});

                // Sort years in descending order
                const sortedYears = Object.keys(entriesByYear).sort((a, b) => b - a);
                
                container.innerHTML = sortedYears.map(year => {
                    const yearEntries = entriesByYear[year];
                    return `
                        <div class="year-section" style="margin-bottom: 2em;">
                            <h3 style="
                                color: #666;
                                border-bottom: 1px solid #ddd;
                                padding-bottom: 0.5em;
                                margin-bottom: 1em;
                            ">${year}</h3>
                            ${yearEntries.map(entry => {
                                const e = entry.entryTags;
                                // Check if it's a CoRR article and change type to misc (pre-print)
                                if (entry.entryType.toLowerCase() === 'article' && e.journal && e.journal.toLowerCase() === 'corr') {
                                    entry.entryType = 'misc';
                                }
                                const typeInfo = getTypeInfo(entry.entryType);
                                const title = e.title || '';
                                const authors = e.author || '';
                                let venue = '';
                                if (entry.entryType.toLowerCase() === 'article') venue = e.journal || '';
                                else if (entry.entryType.toLowerCase() === 'inproceedings') venue = e.booktitle || '';
                                else if (entry.entryType.toLowerCase() === 'incollection') venue = e.booktitle || '';
                                else if (entry.entryType.toLowerCase() === 'book') venue = e.publisher || '';
                                else if (entry.entryType.toLowerCase() === 'misc') venue = e.howpublished || 'arXiv';
                                
                                let link = '';
                                if (e.url) link = e.url;
                                else if (e.doi) link = `https://doi.org/${e.doi}`;
                                
                                return `
                                    <div class="col-12" style="display: flex; align-items: stretch; margin-bottom: 1em;">
                                        <div style="width: 150px; display: flex; justify-content: center; align-items: center;">
                                            <div style="width: 100px; height: 100%; background: white; border-radius: 8px; border: 1px solid rgba(58, 110, 165, 0.2); display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 5px; padding: 0;">
                                                <i class="fas ${typeInfo.icon}" style="font-size: 2em; color: ${typeInfo.color}; margin: 0; padding: 0; line-height: 1;"></i>
                                                <span style="font-size: 0.8em; color: ${typeInfo.color}; text-align: center; margin: 0; padding: 0; line-height: 1;">${typeInfo.label}</span>
                                            </div>
                                        </div>
                                        ${link ? `
                                            <a href="${link}" target="_blank" rel="noopener" style="text-decoration: none; flex: 1;">
                                                <section class="box style1" style="flex: 1; text-align: left; padding: 1.5em; transition: all 0.3s ease; cursor: pointer; background: white;">
                                                    <div>
                                                        <p style="margin: 0; color: #333; line-height: 1.5;">
                                                            ${authors}. <strong>${title}</strong>. ${venue}, ${year}.
                                                        </p>
                                                    </div>
                                                </section>
                                            </a>
                                        ` : `
                                            <section class="box style1" style="flex: 1; text-align: left; padding: 1.5em;">
                                                <div>
                                                    <p style="margin: 0; color: #333; line-height: 1.5;">
                                                        ${authors}. <strong>${title}</strong>. ${venue}, ${year}.
                                                    </p>
                                                </div>
                                            </section>
                                        `}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error processing bibliography:', error);
                container.innerHTML = '<p>Error loading publications. Please try again later.</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching bibliography:', error);
            container.innerHTML = '<p>Error loading publications. Please try again later.</p>';
        });
}

// Call the function immediately
loadPublications();
</script>

<style>
#publications-list a:hover section.box.style1 {
    background-color: #3a6ea5 !important;
}
#publications-list a:hover section.box.style1 p {
    color: white !important;
}
#publications-list a:hover section.box.style1 strong {
    color: white !important;
}
</style>